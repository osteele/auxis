note = name:[A-G]i octave:[0-9]? accidentals:[â™¯#â™­bğ„ªğ„«]*
  {
    accidentals = accidentals.join('').replace(/#/g, 'â™¯').replace(/b/g, 'â™­');
    var sharps = (accidentals.match(/â™¯/g) || '').length + 2 * (accidentals.match(/ğ„ª/g) || '').length;
    var flats = (accidentals.match(/â™­/g) || '').length + 2 * (accidentals.match(/ğ„«/g) || '').length;
    return {
      name: name
    , octave: octave && Number(octave)
    , sharp: sharps - flats
    }
  }

chord =
  root:(note / ('I'i / 'II'i / 'III'i / 'IV'i / 'V'i / 'VI'i / 'VII'i))
  quality:('major'i / 'maj'i / 'minor'i / 'min'i / 'M' / 'm' / 'aug'i / 'dim'i / 'dom'i / [Î”\-+Â°oÃ¸] / 'sus2'i / 'sus4'i / 'mM' / 'm/M')?
  seventh:[679]?
  alter:([â™¯#â™­b+\-]5)?
  extension:([246] / 'add11' / 'add13')?
  bass:('/' note)?
  {
    // TODO (â™­5), m7â™­9â™­13, maj13â™¯11, 7Ã¸â™­9â™­13, add2, add4, 7â™¯9, 7/6
    // TODO V/V
    quality = {M: 'major', m: 'minor'}[quality] || quality || 'major';
    quality = quality.toLowerCase();
    quality = {maj: 'major', min: 'minor', 'Î”': 'major', '-': 'minor', '+': 'aug', 'Â°': 'dim', 'o': 'dim', 'Ã¸': 'm7â™­5'}[quality] || quality;
    return {
      root: root
    , quality: quality || 'major'
    , bass: bass && bass[1]
    , add: add};
  }

progression = head:chord tail:((s? [\-â€“â€”] s? / s) c:chord)*
  {
    var chords = [head];
    tail.forEach(function(t) {chords.push(t[1])});
    return chords;
  }

s
  = [ \t\r\n\f]+
